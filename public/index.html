<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EmoLamp ì›ê²© ì œì–´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        h1 span {
            font-size: 2.5rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .card h2 {
            font-size: 1.2rem;
            margin-bottom: 16px;
            color: #a0a0a0;
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .status-row:last-child {
            border-bottom: none;
        }

        .status-label {
            color: #a0a0a0;
        }

        .status-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .color-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 20px auto;
            box-shadow: 0 0 60px var(--glow-color, #50C878);
            transition: all 0.3s ease;
        }

        .mode-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.3);
            background: transparent;
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: rgba(255,255,255,0.2);
            border-color: #fff;
        }

        .mode-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .slider-group {
            margin-bottom: 20px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            -webkit-appearance: none;
            appearance: none;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        #hueSlider {
            background: linear-gradient(to right, 
                hsl(0, 100%, 50%), 
                hsl(60, 100%, 50%), 
                hsl(120, 100%, 50%), 
                hsl(180, 100%, 50%), 
                hsl(240, 100%, 50%), 
                hsl(300, 100%, 50%), 
                hsl(360, 100%, 50%)
            );
        }

        #satSlider {
            background: linear-gradient(to right, #808080, #ff0000);
        }

        #brightSlider {
            background: linear-gradient(to right, #000, #fff);
        }

        .apply-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .apply-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .apply-btn:active {
            transform: translateY(0);
        }

        .connection-status {
            text-align: center;
            padding: 8px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .connected {
            background: rgba(80, 200, 120, 0.2);
            color: #50C878;
        }

        .disconnected {
            background: rgba(255, 100, 100, 0.2);
            color: #ff6464;
        }

        .emoji {
            font-size: 2rem;
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.5rem;
            }
            h1 span {
                font-size: 2rem;
            }
            .card {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><span>ğŸ’¡</span> EmoLamp ì›ê²© ì œì–´</h1>

        <div class="connection-status" id="connectionStatus">
            ì—°ê²° ì¤‘...
        </div>

        <!-- í˜„ì¬ ìƒíƒœ -->
        <div class="card">
            <h2>ğŸ“Š í˜„ì¬ ìƒíƒœ</h2>
            <div class="color-preview" id="colorPreview"></div>
            <div class="status-row">
                <span class="status-label">ëª¨ë“œ</span>
                <span class="status-value" id="currentMode">AUTO</span>
            </div>
            <div class="status-row">
                <span class="status-label">ê°ì •</span>
                <span class="status-value" id="currentEmotion">ğŸ˜Œ í‰ì˜¨</span>
            </div>
            <div class="status-row">
                <span class="status-label">ë‚ ì”¨</span>
                <span class="status-value" id="currentWeather">-</span>
            </div>
            <div class="status-row">
                <span class="status-label">HSV</span>
                <span class="status-value" id="currentHSV">H:120 S:70 V:70</span>
            </div>
        </div>

        <!-- ì œì–´ íŒ¨ë„ -->
        <div class="card">
            <h2>ğŸ® LED ì œì–´</h2>
            
            <div class="mode-toggle">
                <button class="mode-btn active" id="autoBtn" onclick="setMode('AUTO')">AUTO</button>
                <button class="mode-btn" id="manualBtn" onclick="setMode('MANUAL')">MANUAL</button>
            </div>

            <div id="manualControls">
                <div class="slider-group">
                    <div class="slider-label">
                        <span>ìƒ‰ê° (Hue)</span>
                        <span id="hueValue">120Â°</span>
                    </div>
                    <input type="range" class="slider" id="hueSlider" min="0" max="360" value="120">
                </div>

                <div class="slider-group">
                    <div class="slider-label">
                        <span>ì±„ë„ (Saturation)</span>
                        <span id="satValue">70%</span>
                    </div>
                    <input type="range" class="slider" id="satSlider" min="0" max="100" value="70">
                </div>

                <div class="slider-group">
                    <div class="slider-label">
                        <span>ë°ê¸° (Brightness)</span>
                        <span id="brightValue">70%</span>
                    </div>
                    <input type="range" class="slider" id="brightSlider" min="0" max="100" value="70">
                </div>

                <button class="apply-btn" onclick="applyColor()">
                    ğŸš€ ìƒ‰ìƒ ì ìš©
                </button>
            </div>
        </div>

        <!-- ë¹ ë¥¸ ê°ì • ì„ íƒ -->
        <div class="card">
            <h2>ğŸ­ ë¹ ë¥¸ ê°ì • ì„ íƒ</h2>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                <button class="mode-btn" onclick="setEmotion('joy', 50)">ğŸ˜Š<br>ê¸°ì¨</button>
                <button class="mode-btn" onclick="setEmotion('sadness', 220)">ğŸ˜¢<br>ìŠ¬í””</button>
                <button class="mode-btn" onclick="setEmotion('anger', 0)">ğŸ˜ <br>ë¶„ë…¸</button>
                <button class="mode-btn" onclick="setEmotion('calm', 120)">ğŸ˜Œ<br>í‰ì˜¨</button>
                <button class="mode-btn" onclick="setEmotion('excited', 30)">ğŸ¤©<br>ì„¤ë ˜</button>
                <button class="mode-btn" onclick="setEmotion('fear', 280)">ğŸ˜¨<br>ë‘ë ¤ì›€</button>
                <button class="mode-btn" onclick="setEmotion('surprise', 60)">ğŸ˜²<br>ë†€ëŒ</button>
                <button class="mode-btn" onclick="setEmotion('neutral', 180)">ğŸ˜<br>ì¤‘ë¦½</button>
            </div>
        </div>
    </div>

    <script>
        // ì„œë²„ URL (ê°™ì€ ë„ë©”ì¸)
        const API_BASE = '';
        
        let currentState = {
            mode: 'AUTO',
            hue: 120,
            saturation: 70,
            brightness: 70
        };

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            setupSliders();
            fetchState();
            setInterval(fetchState, 3000); // 3ì´ˆë§ˆë‹¤ ìƒíƒœ ê°±ì‹ 
        });

        // ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ ì„¤ì •
        function setupSliders() {
            const hueSlider = document.getElementById('hueSlider');
            const satSlider = document.getElementById('satSlider');
            const brightSlider = document.getElementById('brightSlider');

            hueSlider.addEventListener('input', (e) => {
                document.getElementById('hueValue').textContent = e.target.value + 'Â°';
                updatePreview();
            });

            satSlider.addEventListener('input', (e) => {
                document.getElementById('satValue').textContent = e.target.value + '%';
                updatePreview();
            });

            brightSlider.addEventListener('input', (e) => {
                document.getElementById('brightValue').textContent = e.target.value + '%';
                updatePreview();
            });
        }

        // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        function updatePreview() {
            const h = document.getElementById('hueSlider').value;
            const s = document.getElementById('satSlider').value;
            const v = document.getElementById('brightSlider').value;

            const color = hsvToHex(h, s, v);
            const preview = document.getElementById('colorPreview');
            preview.style.background = color;
            preview.style.setProperty('--glow-color', color);
        }

        // ì„œë²„ì—ì„œ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
        async function fetchState() {
            try {
                const response = await fetch(API_BASE + '/api/state');
                if (response.ok) {
                    const state = await response.json();
                    updateUI(state);
                    setConnectionStatus(true);
                } else {
                    setConnectionStatus(false);
                }
            } catch (error) {
                console.error('Fetch error:', error);
                setConnectionStatus(false);
            }
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI(state) {
            currentState = state;

            // ëª¨ë“œ
            document.getElementById('currentMode').textContent = state.mode;
            document.getElementById('autoBtn').classList.toggle('active', state.mode === 'AUTO');
            document.getElementById('manualBtn').classList.toggle('active', state.mode === 'MANUAL');

            // ê°ì •
            const emotionMap = {
                'joy': 'ğŸ˜Š ê¸°ì¨',
                'sadness': 'ğŸ˜¢ ìŠ¬í””',
                'anger': 'ğŸ˜  ë¶„ë…¸',
                'calm': 'ğŸ˜Œ í‰ì˜¨',
                'excited': 'ğŸ¤© ì„¤ë ˜',
                'fear': 'ğŸ˜¨ ë‘ë ¤ì›€',
                'surprise': 'ğŸ˜² ë†€ëŒ'
            };
            document.getElementById('currentEmotion').textContent = emotionMap[state.emotion] || 'ğŸ˜ ì¤‘ë¦½';

            // ë‚ ì”¨
            document.getElementById('currentWeather').textContent = state.weather || '-';

            // HSV
            document.getElementById('currentHSV').textContent = 
                `H:${state.hue} S:${state.saturation} V:${state.brightness}`;

            // ìŠ¬ë¼ì´ë” ë™ê¸°í™”
            document.getElementById('hueSlider').value = state.hue;
            document.getElementById('satSlider').value = state.saturation;
            document.getElementById('brightSlider').value = state.brightness;
            document.getElementById('hueValue').textContent = state.hue + 'Â°';
            document.getElementById('satValue').textContent = state.saturation + '%';
            document.getElementById('brightValue').textContent = state.brightness + '%';

            // ìƒ‰ìƒ ë¯¸ë¦¬ë³´ê¸°
            const color = hsvToHex(state.hue, state.saturation, state.brightness);
            const preview = document.getElementById('colorPreview');
            preview.style.background = color;
            preview.style.setProperty('--glow-color', color);
        }

        // ì—°ê²° ìƒíƒœ í‘œì‹œ
        function setConnectionStatus(connected) {
            const el = document.getElementById('connectionStatus');
            if (connected) {
                el.textContent = 'â— ì„œë²„ ì—°ê²°ë¨';
                el.className = 'connection-status connected';
            } else {
                el.textContent = 'â—‹ ì„œë²„ ì—°ê²° ëŠê¹€';
                el.className = 'connection-status disconnected';
            }
        }

        // ëª¨ë“œ ë³€ê²½
        async function setMode(mode) {
            try {
                await fetch(API_BASE + '/api/state', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mode })
                });
                fetchState();
            } catch (error) {
                console.error('Set mode error:', error);
            }
        }

        // ìƒ‰ìƒ ì ìš©
        async function applyColor() {
            const h = parseInt(document.getElementById('hueSlider').value);
            const s = parseInt(document.getElementById('satSlider').value);
            const v = parseInt(document.getElementById('brightSlider').value);

            try {
                await fetch(API_BASE + '/api/state', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mode: 'MANUAL',
                        hue: h,
                        saturation: s,
                        brightness: v,
                        manualColorHex: hsvToHex(h, s, v)
                    })
                });
                fetchState();
            } catch (error) {
                console.error('Apply color error:', error);
            }
        }

        // ë¹ ë¥¸ ê°ì • ì„ íƒ
        async function setEmotion(emotion, hue) {
            try {
                await fetch(API_BASE + '/api/state', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mode: 'AUTO',
                        emotion: emotion,
                        hue: hue
                    })
                });
                fetchState();
            } catch (error) {
                console.error('Set emotion error:', error);
            }
        }

        // HSV to HEX ë³€í™˜
        function hsvToHex(h, s, v) {
            h = h / 360;
            s = s / 100;
            v = v / 100;

            let r, g, b;
            const i = Math.floor(h * 6);
            const f = h * 6 - i;
            const p = v * (1 - s);
            const q = v * (1 - f * s);
            const t = v * (1 - (1 - f) * s);

            switch (i % 6) {
                case 0: r = v; g = t; b = p; break;
                case 1: r = q; g = v; b = p; break;
                case 2: r = p; g = v; b = t; break;
                case 3: r = p; g = q; b = v; break;
                case 4: r = t; g = p; b = v; break;
                case 5: r = v; g = p; b = q; break;
            }

            const toHex = (x) => {
                const hex = Math.round(x * 255).toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            };

            return '#' + toHex(r) + toHex(g) + toHex(b);
        }
    </script>
</body>
</html>
